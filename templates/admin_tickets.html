{% extends "admin_base.html" %}
{% block admin_content %}
<div class="bg-white rounded-2xl shadow p-5">
  <div class="flex items-center justify-between gap-3">
    <div>
      <h2 class="text-xl font-semibold">Painel — {{ event.name }}</h2>
      <p class="text-sm text-zinc-600">Total: {{ total }} | Emitidos: {{ issued }} | Check-in: {{ checked }}</p>
    </div>
    <form method="post" action="{{ url_for('admin_logout') }}">
      <button class="text-sm underline">Sair</button>
    </form>
  </div>

  <form method="get" class="mt-4 flex gap-2">
    <input name="q" value="{{ q }}" placeholder="Buscar nome, telefone, email, token..." class="w-full rounded-xl border p-3">
    <input type="hidden" name="event" value="{{ event.slug }}">
    <button class="rounded-xl bg-black text-white px-4">Buscar</button>
  </form>

  <div class="mt-3 flex gap-2">
    <a class="text-sm underline" href="{{ url_for('admin_export_csv', event=event.slug) }}">Exportar CSV</a>
  </div>

  <div class="mt-4 overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="text-left text-zinc-500">
          <th class="py-2">#</th>
          <th>Comprador</th>
          <th>Status</th>
          <th>Link</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tickets %}
          <tr class="border-t">
            <td class="py-2">{{ t.id }}</td>
            <td>
              <div class="font-medium">{{ t.buyer_name }}</div>
              <div class="text-xs text-zinc-500">{{ t.buyer_phone or "" }} {{ "·" if t.buyer_phone and t.buyer_email else "" }} {{ t.buyer_email or "" }}</div>
            </td>
            <td>
              {% if t.status == "checked_in" %}
                <span class="px-2 py-1 rounded-lg bg-emerald-100">checked-in</span>
              {% else %}
                <span class="px-2 py-1 rounded-lg bg-zinc-100">{{ t.status }}</span>
              {% endif %}
            </td>
            <td>
              <a class="underline" href="{{ url_for('tickets.purchase_public', token=purchase.token, _external=True) }}">abrir</a>
              <span class="text-zinc-400">·</span>
              <a class="underline" href="{{ url_for('checkin', token=t.token) }}">check-in</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
