{% extends "base.html" %}
{% block content %}
<div class="bg-white rounded-2xl shadow p-5">
  <h2 class="text-xl font-semibold">Comprar ingresso — {{ event.name }}</h2>

  <div class="mt-3 rounded-xl bg-zinc-50 border p-3 text-sm text-zinc-700">
    <div class="font-semibold">Como funciona</div>
    <ul class="list-disc pl-5 mt-1 space-y-1">
      <li>O valor é <b>por pessoa</b>.</li>
      <li>Você precisa informar <b>nome e sobrenome</b> do comprador e de cada acompanhante.</li>
      <li>Escreva <b>1 pessoa por linha</b> em “Acompanhantes”.</li>
    </ul>
  </div>

  <form method="post" action="{{ url_for('purchase.buy_post', event_slug=event.slug) }}" class="mt-4 grid gap-3">
    <!-- ... seus campos ... -->

    <div>
      <label class="text-sm text-zinc-600">Acompanhantes (1 por linha, nome e sobrenome)</label>
      <textarea name="guests_text" rows="5" class="w-full rounded-xl border p-3"
        placeholder="Ex:
Aline Souza
Luana Junqueira
Leonora Pinto"></textarea>
      <p class="text-xs text-zinc-500 mt-2">Dica: cada linha vira um ingresso separado.</p>
    </div>

    <div class="mt-1">
      <label class="block text-sm font-medium mb-2">Forma de pagamento</label>
      <div class="flex gap-4">
        <label class="flex items-center gap-2">
          <input type="radio" name="pay_method" value="pix" checked>
          <span>Pix</span>
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="pay_method" value="card">
          <span>Cartão</span>
        </label>
      </div>
    </div>

    <button type="submit" class="mt-2 w-full rounded-xl bg-black text-white py-3 font-medium">
      Ir para pagamento
    </button>
  </form>
</div>

<script>
  (function () {
    const input = document.getElementById("buyer_phone");
    if (!input) return;
    function onlyDigits(s) { return (s || "").replace(/\D/g, ""); }
    function formatBRPhone(digits) {
      digits = digits.slice(0, 11);
      const ddd = digits.slice(0, 2);
      const rest = digits.slice(2);
      if (!ddd) return "";
      if (digits.length <= 10) {
        const p1 = rest.slice(0, 4);
        const p2 = rest.slice(4, 8);
        if (!p1) return `(${ddd}`;
        if (!p2) return `(${ddd}) ${p1}`;
        return `(${ddd}) ${p1}-${p2}`;
      } else {
        const p1 = rest.slice(0, 5);
        const p2 = rest.slice(5, 9);
        if (!p1) return `(${ddd}`;
        if (!p2) return `(${ddd}) ${p1}`;
        return `(${ddd}) ${p1}-${p2}`;
      }
    }
    function applyMask() { input.value = formatBRPhone(onlyDigits(input.value)); }
    input.addEventListener("input", applyMask);
    input.addEventListener("blur", applyMask);
  })();
</script>
{% endblock %}
