{% extends "base.html" %}
{% block content %}

<div class="max-w-2xl mx-auto bg-white rounded-2xl shadow p-5 text-center">

  <h2 class="text-2xl font-semibold mb-1">Sons & Sabores</h2>
  <p class="text-sm text-zinc-500 mb-4">{{ purchase.show_name }}</p>

  {% if payment and payment.status == "paid" %}

    {% if payment.tickets_pdf_url or payment.tickets_zip_url %}
      <div class="bg-white rounded-2xl shadow p-4 mb-4 flex flex-col gap-2 items-center text-center">
        <p class="text-green-700 font-medium">Pagamento confirmado ✅</p>
        <p class="text-sm text-zinc-500">Seus ingressos já estão liberados.</p>

        <a href="{{ url_for('tickets.purchase_public', token=purchase.token) }}"
           class="mt-2 inline-block rounded-xl bg-black text-white px-6 py-3">
          Ver ingressos
        </a>

        <div class="mt-2 flex flex-col gap-2 items-center">
          {% if payment.tickets_pdf_url %}
            <a href="{{ payment.tickets_pdf_url }}" target="_blank"
               class="inline-block rounded-xl border px-6 py-3">
              Baixar PDF
            </a>
          {% endif %}

          {% if payment.tickets_zip_url %}
            <a href="{{ payment.tickets_zip_url }}" target="_blank"
               class="inline-block rounded-xl border px-6 py-3">
              Baixar ZIP
            </a>
          {% endif %}
        </div>

        <p class="text-xs text-zinc-500 mt-3">Redirecionando automaticamente…</p>
        <script>
          setTimeout(() => {
            window.location.href = "{{ url_for('tickets.purchase_public', token=purchase.token) }}";
          }, 1500);
        </script>
      </div>

    {% else %}
      <div class="bg-white rounded-2xl shadow p-4 mb-4 text-center">
        <p class="text-green-700 font-medium">Pagamento confirmado ✅</p>
        <p class="text-sm text-zinc-500 mt-1">Estamos gerando seus arquivos para download…</p>
        <p class="text-xs text-zinc-500 mt-2">Essa página vai atualizar automaticamente.</p>
        <script>
          setTimeout(() => window.location.reload(), 3000);
        </script>
      </div>
    {% endif %}

  {% else %}

    <p class="text-zinc-700">
      Seu pagamento está sendo processado.<br>
      Assim que for confirmado, seus ingressos serão liberados automaticamente.
    </p>

    <div class="mt-5 flex flex-col gap-2 items-center">
      <button type="button"
              onclick="window.location.reload()"
              class="rounded-xl border px-5 py-2 text-sm">
        Atualizar agora
      </button>
      <p class="text-xs text-zinc-500">Verificando automaticamente…</p>
    </div>

    <p class="text-xs text-zinc-500 mt-3">Você pode fechar esta página com segurança.</p>

    <script>
      setTimeout(() => window.location.reload(), 5000);
    </script>

  {% endif %}

</div>

{% endblock %}
