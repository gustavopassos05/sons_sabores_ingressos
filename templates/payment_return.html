{% extends "base.html" %}
{% block content %}
<div class="bg-white rounded-2xl shadow p-6 text-center">

  <h2 class="text-xl font-semibold mb-2">Pagamento em processamento</h2>

  {% if payment and payment.status == "paid" %}
    <p class="text-green-700 font-medium">
      Pagamento confirmado ✅
    </p>

    {# ✅ Links de download (quando já existirem) #}
    {% if payment.tickets_pdf_url or payment.tickets_zip_url %}
      <div class="mt-4 flex flex-col gap-2 items-center">
        {% if payment.tickets_pdf_url %}
          <a href="{{ payment.tickets_pdf_url }}" target="_blank"
             class="inline-block rounded-xl bg-black text-white px-6 py-3">
            Baixar ingressos (PDF)
          </a>
        {% endif %}
        {% if payment.tickets_zip_url %}
          <a href="{{ payment.tickets_zip_url }}" target="_blank"
             class="inline-block rounded-xl border px-6 py-3">
            Baixar (ZIP)
          </a>
        {% endif %}
      </div>
    {% else %}
      <p class="text-zinc-600 mt-3">
        Estamos gerando seus ingressos… só um instante.
      </p>
      <script>
        setTimeout(() => window.location.reload(), 3000);
      </script>
    {% endif %}

    <a href="{{ url_for('tickets.purchase_public', token=purchase.token) }}"
       class="mt-4 inline-block rounded-xl bg-black text-white px-6 py-3">
      Ver ingressos
    </a>

    <p class="text-xs text-zinc-500 mt-3">
      Redirecionando automaticamente…
    </p>

    <script>
      setTimeout(() => {
        window.location.href = "{{ url_for('tickets.purchase_public', token=purchase.token) }}";
      }, 1500);
    </script>

  {% else %}
    <p class="text-zinc-600">
      Seu pagamento está sendo processado.<br>
      Assim que for confirmado, seus ingressos serão liberados automaticamente.
    </p>

    <div class="mt-5 flex flex-col gap-2 items-center">
      <button type="button"
              onclick="window.location.reload()"
              class="rounded-xl border px-5 py-2 text-sm">
        Atualizar agora
      </button>

      <p class="text-xs text-zinc-500">
        Verificando automaticamente…
      </p>
    </div>

    <p class="text-xs text-zinc-500 mt-3">
      Você pode fechar esta página com segurança.
    </p>

    <script>
      // tenta de novo a cada 5s
      setTimeout(() => window.location.reload(), 5000);
    </script>
  {% endif %}

</div>
{% endblock %}
