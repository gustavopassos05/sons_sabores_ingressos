{% extends "base.html" %}
{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">

  <div class="mb-6">
    <h1 class="text-2xl sm:text-3xl font-semibold">{{ app_name }}</h1>
    <p class="text-sm text-zinc-500 mt-1">
      Escolha a atração e faça sua reserva.
    </p>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for c in cards %}
      <div class="rounded-2xl border shadow-sm overflow-hidden flex flex-col
                  {% if c.is_past %} bg-zinc-50 {% else %} bg-white {% endif %}">

        {# ✅ imagem sem cortar rosto #}
        <div class="aspect-[16/9] bg-zinc-100 overflow-hidden flex items-center justify-center">
          <img
            src="{{ c.img }}"
            alt="{{ c.original_name or c.name }}"
            class="w-full h-full object-contain"
            onerror="this.onerror=null;this.src='{{ url_for('static', filename='shows/placeholder.jpg') }}';"
          />
        </div>

        <div class="p-4 flex-1 flex flex-col gap-2">

          {# ✅ badge encerrado #}
          {% if c.is_past %}
            <div class="text-xs text-red-700 bg-red-50 border border-red-200 rounded-full px-3 py-1 w-fit">
              Encerrado
            </div>
          {% endif %}

          {# ✅ Título sem truncate (quebra em até 3 linhas) #}
          <div class="text-lg font-semibold leading-tight text-zinc-900"
               style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">
            {{ c.name }}
          </div>

          {# ✅ Nome real menor (se for diferente) #}
          {% if c.original_name and c.original_name != c.name %}
            <div class="text-sm text-zinc-600 leading-snug"
                 style="display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">
              {{ c.original_name }}
            </div>
          {% endif %}

          {# ✅ Data/hora em outra linha #}
          {% if c.date_text %}
            <div class="text-xs text-zinc-600 bg-zinc-100 rounded-full px-3 py-1 w-fit">
              {{ c.date_text }}
            </div>
          {% endif %}

          <div class="text-sm text-zinc-500">{{ c.subtitle }}</div>

          <p class="text-sm text-zinc-700 leading-relaxed"
             style="display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;">
            {{ c.desc }}
          </p>

          <div class="mt-1 text-xs text-zinc-500">
            {% if c.requires_ticket == 0 %}
              Reserva (sem ingresso)
            {% else %}
              {% if c.price_cents is none %}
                Preço em definição
              {% else %}
                Ingresso: R$ {{ '%.2f'|format((c.price_cents or 0)/100) }}
              {% endif %}
            {% endif %}
          </div>

          <div class="mt-4">
            {% if c.is_past %}
              <button
                type="button"
                disabled
                class="inline-flex w-full justify-center rounded-xl bg-zinc-200 text-zinc-600 py-3 font-medium cursor-not-allowed"
              >
                Encerrado
              </button>
            {% else %}
              <a
                href="{{ url_for('purchase.buy', event_slug=event.slug, show_slug=c.slug) }}"
                class="inline-flex w-full justify-center rounded-xl bg-black text-white py-3 font-medium hover:opacity-90"
              >
                Reservar agora
              </a>
            {% endif %}
          </div>

          <div class="text-xs text-zinc-400 text-center">
            {% if c.is_past %}
              Este show já aconteceu.
            {% else %}
              Você será direcionado(a) para o formulário de reserva.
            {% endif %}
          </div>

        </div>
      </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
